# 游戏模块

流程:

1. 用户连接Socket, 通过用户模块身份校验(不通过则关闭)
2. 自动进入大厅, 接收房间信息更新广播
3. 用户拉取房间列表, 返回`GameMeta[]`
4. 用户选择房间进入或者创建房间, 返回`GameMeta`, 离开大厅, 停止接收广播
5. 用户准备, 返回`void`
    1. 启动`timer`, 超时未准备玩家自动踢出
    2. 房间内广播准备状态变化, 数据为`GameMeta`
    3. 大厅内广播房间状态更新
6. 游戏开始, 请求所有客户端确认, 大厅广播
7. 所有客户端确认后发牌, 并开始第一次抢地主
8. 客户端请求抢地主, 返回结果, 广播其它玩家
    1. 返回及广播中应该带有状态更新标志: 是否结束抢地主, 如果结束, 应该带有底牌, 地主是谁, 倍数, 底牌倍数
9. 开始游戏, 玩家出牌, 返回结果, 广播状态
    1. 状态中应该包含出牌, 座位, 下一位应该出牌玩家, 下一位是否可以过
    2. 还应该包含游戏是否结束, 如果结束, 胜负情况, 得分情况, 余牌情况
10. 游戏结束, 大厅广播, 状态回到`4`
11. 用户取消`Ready`
    1. 如果全都未`Ready`, 取消`tiemr`
    2. 否则开始此用户`timer`
    3. 大厅广播, 房间广播
12. 用户退出
    1. 如果用户未`Ready`, 广播, 大厅广播
    2. 如果用户`Ready`, 广播, 大厅广播
    3. 如果游戏中, 广播游戏结束, 结束原因, 胜负及得分情况, 大厅广播房间重新开始

**细节**

- 所有的带有定时的操作的信息都应该有一个`endAt`标志结束时间, 客户端通过这个字段来展示倒计时
- 房间内广播信息忽略状态创建者
- 所有的`抢地主`及`出牌`操作都需要带上一个连续递增的`id`, 用来判断客户端是否有消息缺失, 如果有, 则需要同步数据, 并且标志为出牌/抢失败


